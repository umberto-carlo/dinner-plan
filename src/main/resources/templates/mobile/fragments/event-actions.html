<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
    <div id="event-action-bar" th:fragment="eventActions" class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 mb-6">
        <h3 th:text="#{event.proposals}" style="margin-bottom: 1rem;">Proposte</h3>
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            <!-- Manage Participants (Organizer only) -->
            <button th:if="${isOrganizer}"
                onclick="document.getElementById('manage-participants-modal').style.display='block'"
                class="w-full text-center inline-flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
                th:text="${event.status.name() == 'OPEN'} ? #{event.actions.manage_participants} : #{event.actions.view_participants}">
                Gestisci Partecipanti
            </button>

            <!-- Add Central Proposal (Organizer only) -->
            <button th:if="${isOrganizer and event.status.name() == 'OPEN' and canAddCentralProposal}"
                onclick="document.getElementById('add-central-proposal-modal').style.display='block'"
                class="w-full text-center inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-full shadow-sm text-sm font-medium text-white bg-secondary-600 hover:bg-secondary-700"
                th:text="#{event.actions.add_central_proposal}">
                Aggiungi Proposta Centrale
            </button>

            <!-- Only Organizer can add proposals AND event must be OPEN -->
            <button th:if="${isOrganizer and event.status.name() == 'OPEN'}"
                onclick="document.getElementById('add-proposal-form').style.display='block'"
                class="w-full text-center inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-full shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700"
                th:text="#{event.proposals.add}">
                Aggiungi Proposta
            </button>

            <!-- Add to Calendar -->
            <a th:href="@{/events/{id}/ics(id=${event.id})}" target="_blank"
                class="w-full text-center inline-flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span th:text="#{event.details.ics_export}">Add to Calendar (ICS)</span>
            </a>

            <!-- Delete Event (Organizer only) -->
            <form th:if="${isOrganizer}" th:action="@{/events/{id}/delete(id=${event.id})}" method="post"
                style="width: 100%; margin: 0;">
                <button type="submit"
                    class="w-full text-center inline-flex justify-center items-center px-4 py-2 border border-red-300 dark:border-red-700 rounded-full shadow-sm text-sm font-medium text-red-700 dark:text-red-400 bg-white dark:bg-gray-700 hover:bg-red-50 dark:hover:bg-gray-600"
                    th:onclick="'return confirm(\'' + #{event.actions.delete_confirm} + '\');'"
                    th:text="#{event.actions.delete}">
                    Elimina Evento
                </button>
            </form>
        </div>
    </div>
</body>

</html>